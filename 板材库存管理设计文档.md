# 板材库存管理详细设计文档

## 📋 总体设计思路

### 界面布局（参考图纸库组件）
```
┌─────────────────────────────────────────────────────────────┐
│                    板材管理页面                              │
├──────────────┬──────────────────────────────────────────────┤
│              │                                              │
│   左侧边栏    │              主显示区域                      │
│              │                                              │
│  📂 材质分类  │       根据左侧选择显示对应内容                │
│  📊 库存统计  │                                              │
│  🔄 借用管理  │                                              │
│  📋 用料记录  │                                              │
│              │                                              │
└──────────────┴──────────────────────────────────────────────┘
```

## 🗂️ 左侧边栏设计

### 侧边栏分类
```
📂 材质库存
├─ 📋 锰板 (45张)
│   ├─ 原平板 (25张)
│   └─ 开平板 (20张)
├─ 📋 碳板 (32张)  
│   ├─ 原平板 (18张)
│   └─ 开平板 (14张)
└─ 📋 不锈钢板 (28张)
    ├─ 原平板 (15张)
    └─ 开平板 (13张)

📊 统计信息
├─ 📈 库存总览
├─ 👥 归属统计
└─ 📅 用料统计

🔄 借用管理
├─ 🔴 待归还 (3条)
├─ ✅ 已归还
└─ ➕ 新建借用

📋 用料记录
├─ 📅 今日用料
├─ 📊 本周统计
└─ 🔍 历史记录

⚙️ 管理设置
├─ ➕ 入库管理
├─ 🔧 规格管理
└─ 👥 工人管理
```

## 🖥️ 主显示区域设计

### 根据左侧选择显示不同内容

#### 1. 选择"锰板-原平板"时
```
主显示区域：
┌─────────────────────────────────────────────────────────────┐
│  📋 锰板-原平板库存详情                                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  厚度规格    尺寸        归属人    库存数量   已用数量   操作  │
│  ─────────────────────────────────────────────────────────  │
│  3mm       1220×2440    张三      15张      5张       [...] │
│  3mm       1220×2440    李四      8张       2张       [...] │
│  3mm       600×800      王五      12张      0张       [...] │
│  4mm       1220×2440    张三      10张      3张       [...] │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  📦 余料池                                                   │
│  ├─ 3mm 不规则余料 × 5块 (张三)                              │
│  ├─ 4mm 不规则余料 × 2块 (李四)                              │
│  └─ [➕ 添加余料]                                            │
│                                                             │
│  [➕ 新增库存] [📊 导出统计] [🔄 刷新]                        │
└─────────────────────────────────────────────────────────────┘
```

#### 2. 选择"借用管理-待归还"时
```
主显示区域：
┌─────────────────────────────────────────────────────────────┐
│  🔄 待归还借用记录                                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  借用时间     借用人   被借用人   材质规格        数量   操作  │
│  ─────────────────────────────────────────────────────────  │
│  2024-12-15   张三     李四      碳板原平4mm     2张    [归还]│
│  2024-12-14   王五     张三      不锈钢开平3mm   1张    [归还]│
│  2024-12-13   李四     王五      锰板原平5mm     3张    [归还]│
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  [➕ 新建借用] [📊 借用统计] [🔄 刷新]                        │
└─────────────────────────────────────────────────────────────┘
```

#### 3. 选择"用料记录-今日用料"时
```
主显示区域：
┌─────────────────────────────────────────────────────────────┐
│  📋 今日用料记录 (2024-12-15)                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  时间    项目名   工人   材质规格        数量   切割号    余料 │
│  ─────────────────────────────────────────────────────────  │
│  09:30   项目A   张三   锰板原平3mm     1张    C1215-001   ✓  │
│  09:30   项目B   张三   锰板原平3mm     0张    C1215-001   ✓  │
│  10:15   项目C   李四   碳板开平4mm     2张    C1215-002   ✗  │
│  14:20   项目D   王五   不锈钢原平5mm   1张    C1215-003   ✓  │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  📊 今日统计：共用料 4张，产生余料 3次                        │
│                                                             │
│  [📊 详细统计] [📄 导出报告] [🔄 刷新]                        │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 与MaterialsTable的集成

### MaterialsTable调整
保持原有布局，仅增加必要列：
```
项目名|工人|2mm|3mm|4mm|5mm|备注|开始时间|完成时间|图纸|📦用料|切割号
```

### 📦用料按钮功能
点击后弹出用料选择模态框：
```
┌─────────────────────────────────────┐
│  📦 项目A 用料选择                   │
├─────────────────────────────────────┤
│                                     │
│  🎯 快速选择：                       │
│  [锰板3mm] [碳板4mm] [不锈钢5mm]     │
│                                     │
│  📋 详细选择：                       │
│  材质：[锰板 ▼]                     │
│  类型：[原平板 ▼]                   │
│  厚度：[3mm ▼]                      │
│  尺寸：[1220×2440 ▼]               │
│  归属：[张三(15张) ▼]               │
│  数量：[1] 张                       │
│                                     │
│  ☑️ 与其他项目拼板切割               │
│  └─ 选择拼板项目：[项目B ▼] [项目C ▼] │
│                                     │
│  [确认] [取消]                      │
└─────────────────────────────────────┘
```

## 📊 数据表结构

### 库存表 (inventory)
```sql
CREATE TABLE inventory (
  id INT PRIMARY KEY AUTO_INCREMENT,
  material_type ENUM('锰板', '碳板', '不锈钢板') NOT NULL,
  process_type ENUM('原平板', '开平板') NOT NULL,
  thickness VARCHAR(10) NOT NULL,
  size VARCHAR(20) NOT NULL,
  owner VARCHAR(50) NOT NULL,
  total_quantity INT DEFAULT 0,
  used_quantity INT DEFAULT 0,
  remainder_count INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 项目用料记录表 (project_materials)
```sql
CREATE TABLE project_materials (
  id INT PRIMARY KEY AUTO_INCREMENT,
  project_id INT NOT NULL,
  inventory_id INT NOT NULL,
  quantity INT NOT NULL,
  cutting_no VARCHAR(50),
  has_remainder BOOLEAN DEFAULT FALSE,
  used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  operator_id INT NOT NULL,
  notes TEXT
);
```

### 借用记录表 (borrow_records)
```sql
CREATE TABLE borrow_records (
  id INT PRIMARY KEY AUTO_INCREMENT,
  borrower_id INT NOT NULL,
  lender_id INT NOT NULL,
  inventory_id INT NOT NULL,
  quantity INT NOT NULL,
  borrow_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  return_date TIMESTAMP NULL,
  status ENUM('borrowed', 'returned') DEFAULT 'borrowed',
  notes TEXT
);
```

## 🎯 核心功能流程

### 1. 单独用料流程
```
MaterialsTable → 点击📦用料 → 选择材料规格 → 确认
                                   ↓
库存扣减 ← 记录用料 ← 更新项目状态 ← 生成切割号
```

### 2. 拼板切割流程
```
MaterialsTable → 选择多个项目 → 批量切割 → 选择材料
                                          ↓
库存扣减 ← 记录用料 ← 批量更新状态 ← 生成统一切割号
```

### 3. 借用管理流程
```
板材管理页面 → 借用管理 → 新建借用 → 选择材料和借用人
                                      ↓
更新库存归属 ← 记录借用 ← 通知双方 ← 生成借用单
```

---

## 📱 组件结构设计

### 主组件：MaterialsManagement
```typescript
interface MaterialsManagementProps {
  className?: string;
}

// 组件内部状态
interface MaterialsManagementState {
  selectedCategory: string;
  selectedSubCategory: string;
  inventoryData: InventoryItem[];
  borrowRecords: BorrowRecord[];
  usageRecords: UsageRecord[];
}
```

### 子组件：
1. **MaterialsSidebar** - 左侧分类导航
2. **InventoryTable** - 库存详情表格
3. **BorrowManagement** - 借用管理
4. **UsageRecords** - 用料记录
5. **InventoryStats** - 统计图表

---

*此文档将作为板材管理功能的详细设计指南，我们可以逐步完善和修改。*